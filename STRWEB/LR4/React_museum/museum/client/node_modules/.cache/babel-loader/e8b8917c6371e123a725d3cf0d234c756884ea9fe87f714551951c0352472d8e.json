{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\React_museum\\\\museum\\\\client\\\\src\\\\components\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth должен использоваться внутри AuthProvider');\n  }\n  return context;\n};\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(() => {\n    const savedUser = localStorage.getItem('museumUser');\n    return savedUser ? JSON.parse(savedUser) : null;\n  });\n  const [loading, setLoading] = useState(true);\n  const [notifications, setNotifications] = useState([]);\n  const addNotification = (message, type = 'info') => {\n    const id = Date.now();\n    const notification = {\n      id,\n      message,\n      type\n    };\n    setNotifications(prev => [...prev, notification]);\n    setTimeout(() => {\n      setNotifications(prev => prev.filter(n => n.id !== notification.id));\n    }, 5000);\n  };\n  // В функции login добавьте:\n  const login = async (username, password) => {\n    setLoading(true);\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username,\n          password\n        })\n      });\n      if (!response.ok) {\n        throw new Error('Ошибка входа');\n      }\n      const data = await response.json();\n      if (data.success) {\n        // Сохраняем ВСЕ данные пользователя\n        const userData = {\n          ...data.user,\n          token: data.user.token // Убедитесь что токен сохраняется\n        };\n        setUser(userData);\n        localStorage.setItem('museumUser', JSON.stringify(userData));\n\n        // Сохраняем токен отдельно для удобства\n        localStorage.setItem('authToken', data.user.token);\n        addNotification('Вход выполнен успешно', 'success');\n        return {\n          success: true,\n          data: userData\n        };\n      } else {\n        throw new Error(data.message || 'Ошибка входа');\n      }\n    } catch (error) {\n      addNotification('Ошибка входа: ' + error.message, 'error');\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  const loginWithGoogle = googleUser => {\n    setUser(googleUser);\n    localStorage.setItem('museumUser', JSON.stringify(googleUser));\n    addNotification(`Вход выполнен как ${googleUser.name}`, 'success');\n  };\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('museumUser');\n    addNotification('Вы вышли из системы', 'info');\n  };\n  const register = async (username, email, password) => {\n    setLoading(true);\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/register', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username,\n          email,\n          password\n        })\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Ошибка регистрации');\n      }\n      const userData = await response.json();\n      setUser(userData);\n      localStorage.setItem('museumUser', JSON.stringify(userData));\n      addNotification('Регистрация успешна', 'success');\n      return {\n        success: true,\n        data: userData\n      };\n    } catch (error) {\n      addNotification('Ошибка регистрации: ' + error.message, 'error');\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  // ЗАМЕНИТЕ весь useEffect в AuthContext.js на этот код:\n  useEffect(() => {\n    // Просто загружаем пользователя из localStorage, НЕ проверяем на сервере\n    const savedUser = localStorage.getItem('museumUser');\n    if (savedUser) {\n      const userData = JSON.parse(savedUser);\n\n      // Проверяем, не истек ли токен (базовая проверка)\n      const tokenExpiry = localStorage.getItem('tokenExpiry');\n      const now = new Date().getTime();\n      if (tokenExpiry && now > parseInt(tokenExpiry)) {\n        // Токен истек\n        logout();\n      } else {\n        // Устанавливаем пользователя\n        setUser(userData);\n        console.log('Пользователь восстановлен из localStorage:', userData.username);\n      }\n    }\n    setLoading(false);\n  }, []); // Пустой массив зависимостей - выполняется только при монтировании\n\n  const value = {\n    user,\n    loading,\n    notifications,\n    addNotification,\n    login,\n    loginWithGoogle,\n    // Добавляем эту функцию\n    logout,\n    register\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"86q8ce798C0gFINCx4CxWZLv7vs=\");\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","AuthProvider","children","_s2","user","setUser","savedUser","localStorage","getItem","JSON","parse","loading","setLoading","notifications","setNotifications","addNotification","message","type","id","Date","now","notification","prev","setTimeout","filter","n","login","username","password","response","fetch","method","headers","body","stringify","ok","data","json","success","userData","token","setItem","error","loginWithGoogle","googleUser","name","logout","removeItem","register","email","tokenExpiry","getTime","parseInt","console","log","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/user/React_museum/museum/client/src/components/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth должен использоваться внутри AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(() => {\r\n    const savedUser = localStorage.getItem('museumUser');\r\n    return savedUser ? JSON.parse(savedUser) : null;\r\n  });\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [notifications, setNotifications] = useState([]);\r\n\r\n  const addNotification = (message, type = 'info') => {\r\n    const id = Date.now();\r\n    const notification = { id, message, type };\r\n    setNotifications(prev => [...prev, notification]);\r\n    \r\n    setTimeout(() => {\r\n      setNotifications(prev => prev.filter(n => n.id !== notification.id));\r\n    }, 5000);\r\n  };\r\n// В функции login добавьте:\r\nconst login = async (username, password) => {\r\n  setLoading(true);\r\n  try {\r\n    const response = await fetch('http://localhost:5000/api/auth/login', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ username, password })\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      throw new Error('Ошибка входа');\r\n    }\r\n    \r\n    const data = await response.json();\r\n    \r\n    if (data.success) {\r\n      // Сохраняем ВСЕ данные пользователя\r\n      const userData = {\r\n        ...data.user,\r\n        token: data.user.token // Убедитесь что токен сохраняется\r\n      };\r\n      \r\n      setUser(userData);\r\n      localStorage.setItem('museumUser', JSON.stringify(userData));\r\n      \r\n      // Сохраняем токен отдельно для удобства\r\n      localStorage.setItem('authToken', data.user.token);\r\n      \r\n      addNotification('Вход выполнен успешно', 'success');\r\n      return { success: true, data: userData };\r\n    } else {\r\n      throw new Error(data.message || 'Ошибка входа');\r\n    }\r\n  } catch (error) {\r\n    addNotification('Ошибка входа: ' + error.message, 'error');\r\n    return { success: false, error: error.message };\r\n  } finally {\r\n    setLoading(false);\r\n  }\r\n};\r\nconst loginWithGoogle = (googleUser) => {\r\n  setUser(googleUser);\r\n  localStorage.setItem('museumUser', JSON.stringify(googleUser));\r\n  addNotification(`Вход выполнен как ${googleUser.name}`, 'success');\r\n};\r\n  const logout = () => {\r\n    setUser(null);\r\n    localStorage.removeItem('museumUser');\r\n    addNotification('Вы вышли из системы', 'info');\r\n  };\r\n\r\n  const register = async (username, email, password) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch('http://localhost:5000/api/auth/register', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username, email, password })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(error.message || 'Ошибка регистрации');\r\n      }\r\n      \r\n      const userData = await response.json();\r\n      setUser(userData);\r\n      localStorage.setItem('museumUser', JSON.stringify(userData));\r\n      addNotification('Регистрация успешна', 'success');\r\n      return { success: true, data: userData };\r\n    } catch (error) {\r\n      addNotification('Ошибка регистрации: ' + error.message, 'error');\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n// ЗАМЕНИТЕ весь useEffect в AuthContext.js на этот код:\r\nuseEffect(() => {\r\n  // Просто загружаем пользователя из localStorage, НЕ проверяем на сервере\r\n  const savedUser = localStorage.getItem('museumUser');\r\n  if (savedUser) {\r\n    const userData = JSON.parse(savedUser);\r\n    \r\n    // Проверяем, не истек ли токен (базовая проверка)\r\n    const tokenExpiry = localStorage.getItem('tokenExpiry');\r\n    const now = new Date().getTime();\r\n    \r\n    if (tokenExpiry && now > parseInt(tokenExpiry)) {\r\n      // Токен истек\r\n      logout();\r\n    } else {\r\n      // Устанавливаем пользователя\r\n      setUser(userData);\r\n      console.log('Пользователь восстановлен из localStorage:', userData.username);\r\n    }\r\n  }\r\n  \r\n  setLoading(false);\r\n}, []); // Пустой массив зависимостей - выполняется только при монтировании\r\n    \r\nconst value = {\r\n  user,\r\n  loading,\r\n  notifications,\r\n  addNotification,\r\n  login,\r\n  loginWithGoogle, // Добавляем эту функцию\r\n  logout,\r\n  register\r\n};\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}