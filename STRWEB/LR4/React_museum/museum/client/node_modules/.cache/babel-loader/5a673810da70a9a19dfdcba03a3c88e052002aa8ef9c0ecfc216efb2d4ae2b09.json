{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\React_museum\\\\museum\\\\client\\\\src\\\\components\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth должен использоваться внутри AuthProvider');\n  }\n  return context;\n};\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(() => {\n    const savedUser = localStorage.getItem('museumUser');\n    return savedUser ? JSON.parse(savedUser) : null;\n  });\n  const [loading, setLoading] = useState(true);\n  const [notifications, setNotifications] = useState([]);\n  const addNotification = (message, type = 'info') => {\n    const id = Date.now();\n    const notification = {\n      id,\n      message,\n      type\n    };\n    setNotifications(prev => [...prev, notification]);\n    setTimeout(() => {\n      setNotifications(prev => prev.filter(n => n.id !== notification.id));\n    }, 5000);\n  };\n  const login = async (username, password) => {\n    setLoading(true);\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username,\n          password\n        })\n      });\n      if (!response.ok) {\n        throw new Error('Ошибка входа');\n      }\n      const data = await response.json();\n      if (data.success) {\n        const userData = {\n          ...data.user,\n          token: data.user.token\n        };\n        setUser(userData);\n        localStorage.setItem('museumUser', JSON.stringify(userData));\n        localStorage.setItem('authToken', data.user.token);\n        addNotification(`Вход выполнен как ${username}`, 'success');\n        return {\n          success: true,\n          data: userData\n        };\n      } else {\n        throw new Error(data.message || 'Ошибка входа');\n      }\n    } catch (error) {\n      addNotification('Ошибка входа: ' + error.message, 'error');\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  const loginWithGoogle = googleUser => {\n    setUser(googleUser);\n    localStorage.setItem('museumUser', JSON.stringify(googleUser));\n    localStorage.setItem('authToken', googleUser.token);\n    addNotification(`Вход выполнен как ${googleUser.name || googleUser.username}`, 'success');\n  };\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('museumUser');\n    localStorage.removeItem('authToken');\n    addNotification('Вы вышли из системы', 'info');\n  };\n  const register = async (username, email, password) => {\n    setLoading(true);\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/register', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username,\n          email,\n          password\n        })\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Ошибка регистрации');\n      }\n      const userData = await response.json();\n      setUser(userData);\n      localStorage.setItem('museumUser', JSON.stringify(userData));\n      addNotification('Регистрация успешна', 'success');\n      return {\n        success: true,\n        data: userData\n      };\n    } catch (error) {\n      addNotification('Ошибка регистрации: ' + error.message, 'error');\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    const savedUser = localStorage.getItem('museumUser');\n    if (savedUser) {\n      try {\n        const userData = JSON.parse(savedUser);\n        const tokenCreated = localStorage.getItem('tokenCreated');\n        const now = new Date().getTime();\n        if (tokenCreated && now - parseInt(tokenCreated) > 7 * 24 * 60 * 60 * 1000) {\n          console.log('Токен истек, выполняется выход');\n          logout();\n        } else {\n          setUser(userData);\n          console.log('Пользователь восстановлен из localStorage');\n        }\n      } catch (error) {\n        console.error('Ошибка восстановления пользователя:', error);\n        localStorage.removeItem('museumUser');\n        localStorage.removeItem('authToken');\n      }\n    }\n    setLoading(false);\n    if (!localStorage.getItem('tokenCreated') && user) {\n      localStorage.setItem('tokenCreated', new Date().getTime().toString());\n    }\n  }, []);\n  const value = {\n    user,\n    loading,\n    notifications,\n    addNotification,\n    login,\n    loginWithGoogle,\n    logout,\n    register\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 151,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"86q8ce798C0gFINCx4CxWZLv7vs=\");\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","AuthProvider","children","_s2","user","setUser","savedUser","localStorage","getItem","JSON","parse","loading","setLoading","notifications","setNotifications","addNotification","message","type","id","Date","now","notification","prev","setTimeout","filter","n","login","username","password","response","fetch","method","headers","body","stringify","ok","data","json","success","userData","token","setItem","error","loginWithGoogle","googleUser","name","logout","removeItem","register","email","tokenCreated","getTime","parseInt","console","log","toString","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/user/React_museum/museum/client/src/components/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth должен использоваться внутри AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(() => {\r\n    const savedUser = localStorage.getItem('museumUser');\r\n    return savedUser ? JSON.parse(savedUser) : null;\r\n  });\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [notifications, setNotifications] = useState([]);\r\n\r\n  const addNotification = (message, type = 'info') => {\r\n    const id = Date.now();\r\n    const notification = { id, message, type };\r\n    setNotifications(prev => [...prev, notification]);\r\n    \r\n    setTimeout(() => {\r\n      setNotifications(prev => prev.filter(n => n.id !== notification.id));\r\n    }, 5000);\r\n  };\r\n\r\n  const login = async (username, password) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch('http://localhost:5000/api/auth/login', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username, password })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Ошибка входа');\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (data.success) {\r\n        const userData = {\r\n          ...data.user,\r\n          token: data.user.token\r\n        };\r\n        \r\n        setUser(userData);\r\n        localStorage.setItem('museumUser', JSON.stringify(userData));\r\n        localStorage.setItem('authToken', data.user.token);\r\n        \r\n        addNotification(`Вход выполнен как ${username}`, 'success');\r\n        return { success: true, data: userData };\r\n      } else {\r\n        throw new Error(data.message || 'Ошибка входа');\r\n      }\r\n    } catch (error) {\r\n      addNotification('Ошибка входа: ' + error.message, 'error');\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loginWithGoogle = (googleUser) => {\r\n    setUser(googleUser);\r\n    localStorage.setItem('museumUser', JSON.stringify(googleUser));\r\n    localStorage.setItem('authToken', googleUser.token);\r\n    addNotification(`Вход выполнен как ${googleUser.name || googleUser.username}`, 'success');\r\n  };\r\n\r\n  const logout = () => {\r\n    setUser(null);\r\n    localStorage.removeItem('museumUser');\r\n    localStorage.removeItem('authToken');\r\n    addNotification('Вы вышли из системы', 'info');\r\n  };\r\n\r\n  const register = async (username, email, password) => {\r\n    setLoading(true);\r\n    try {\r\n      const response = await fetch('http://localhost:5000/api/auth/register', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ username, email, password })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(error.message || 'Ошибка регистрации');\r\n      }\r\n      \r\n      const userData = await response.json();\r\n      setUser(userData);\r\n      localStorage.setItem('museumUser', JSON.stringify(userData));\r\n      addNotification('Регистрация успешна', 'success');\r\n      return { success: true, data: userData };\r\n    } catch (error) {\r\n      addNotification('Ошибка регистрации: ' + error.message, 'error');\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const savedUser = localStorage.getItem('museumUser');\r\n    if (savedUser) {\r\n      try {\r\n        const userData = JSON.parse(savedUser);\r\n         const tokenCreated = localStorage.getItem('tokenCreated');\r\n        const now = new Date().getTime();\r\n        if (tokenCreated && (now - parseInt(tokenCreated)) > 7 * 24 * 60 * 60 * 1000) {         \r\n          console.log('Токен истек, выполняется выход');\r\n          logout();\r\n        } else {          \r\n          setUser(userData);\r\n          console.log('Пользователь восстановлен из localStorage');\r\n        }\r\n      } catch (error) {\r\n        console.error('Ошибка восстановления пользователя:', error);\r\n        localStorage.removeItem('museumUser');\r\n        localStorage.removeItem('authToken');\r\n      }\r\n    }\r\n    \r\n    setLoading(false);\r\n    \r\n    if (!localStorage.getItem('tokenCreated') && user) {\r\n      localStorage.setItem('tokenCreated', new Date().getTime().toString());\r\n    }\r\n  }, []);\r\n\r\n  const value = {\r\n    user,\r\n    loading,\r\n    notifications,\r\n    addNotification,\r\n    login,\r\n    loginWithGoogle,\r\n    logout,\r\n    register\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}