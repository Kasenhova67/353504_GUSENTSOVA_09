{% extends 'layout.html' %}

{% block title %}
    О компании
{% endblock %}

{% block content %}
<div>
    <h1>О компании</h1>
    
    {% if company %}
      
        <div>
            <h2>{{ company.name }}</h2>
            
            {% if company.logo %}
                <img src="{{ company.logo.url }}" alt="Логотип компании" width="200">
            {% endif %}
            
            <p>{{ company.description }}</p>
            
            {% if company.website %}
                <p>Вебсайт: <a href="{{ company.website }}">{{ company.website }}</a></p>
            {% endif %}
            
            {% if company.video %}
                <video width="400" controls>
                    <source src="{{ company.video.url }}" type="video/mp4">
                    Ваш браузер не поддерживает видео.
                </video>
            {% endif %}
        </div>

        <div>
            <h3>История компании</h3>
            {% for history in histories %}
                <div>
                    <h4>{{ history.year }} - {{ history.title }}</h4>
                    {% if history.image %}
                        <img src="{{ history.image.url }}" alt="{{ history.title }}" width="300">
                    {% endif %}
                    <p>{{ history.description }}</p>
                </div>
            {% empty %}
                <p>История компании пока не добавлена.</p>
            {% endfor %}
        </div>

        {% if requisites %}
        <div>
            <h3>Реквизиты</h3>
            {% for requisite in requisites %}
                <p><strong>{{ requisite.title }}:</strong> {{ requisite.value }}</p>
            {% endfor %}
        </div>
        {% endif %}

        {% if certificates %}
        <div>
            <h3>Сертификаты</h3>
            {% for certificate in certificates %}
                <div>
                    <h4>{{ certificate.title }}</h4>
                    {% if certificate.image %}
                        <img src="{{ certificate.image.url }}" alt="{{ certificate.title }}" width="300">
                    {% endif %}
                    <p>{{ certificate.description }}</p>
                    <p><strong>Дата выдачи:</strong> {{ certificate.issue_date }}</p>
                    {% if certificate.expiry_date %}
                        <p><strong>Действителен до:</strong> {{ certificate.expiry_date }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        {% endif %}

    {% else %}
        <p>Информация о компании не найдена.</p>
    {% endif %}

    {% if user.is_staff %}
        <div>
            <h2>Статистика компании</h2>
            <p>Медиана возраста клиентов: {{ client_age_median }}</p>
            <p>Средний возраст клиентов: {{ client_age_mean }}</p>
            <p>Мода возраста клиентов: {{ client_age_mode }}</p>
            <p>Самая высокая цена билета: {{ get_order_with_highest_price }}</p>
            <p>Самая популярная выставка: {{ get_most_popular_exhibition }}</p>
            
            {% if histogram_url %}
                <img src="data:image/png;base64,{{ histogram_url }}" alt="График статистики залов">
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}