{% extends 'layout.html' %}

{% block title %}
    Museum
{% endblock %}

{% block content %}
<div class="museum-container">
    <div class="museum-header">
        <h1 class="museum-title">Museum</h1>
        
        {% if user.is_superuser %}
        <form class="filter-form">
            <div class="filter-control">
                <input type="checkbox" id="show_recent_exhibits" name="show_recent_exhibits" 
                       {% if show_recent_exhibits %}checked{% endif %}>
                <label for="show_recent_exhibits">Show only exhibits added in the last 6 months</label>
            </div>
            <button type="submit" class="filter-button">Apply</button>
        </form>
        {% endif %}
    </div>

    <h3 class="section-title">All Exhibits:</h3>
    <div class="exhibits-grid" id="all-exhibits">
        {% for el in exhibits %}
            {% if not show_recent_exhibits or el.date >= main_date %}
            <div class="exhibit-card">
                <div class="exhibit-image">
                    <img src="{{ el.image_source.url }}" alt="{{ el.name }}"/>
                </div>
                <div class="exhibit-info">
                    <h4 class="exhibit-name">{{ el.name }}</h4>
                    <p class="exhibit-detail"><strong>Art:</strong> {{ el.art }}</p>
                    <p class="exhibit-detail"><strong>Keeper:</strong> {{ el.keeper }}</p>
                    {% if user.is_superuser %}
                    <p class="exhibit-date"><strong>Receipt date:</strong> {{ el.date }}</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>

    <div class="pagination">
        <button id="prev">Prev</button>
        <span id="page-info"></span>
        <button id="next">Next</button>
        <label>
            Per page:
            <select id="pageSize">
                <option value="3" selected>3</option>
                <option value="5">5</option>
                <option value="10">10</option>
            </select>
        </label>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const grid = document.getElementById("all-exhibits");
    const cards = Array.from(grid.querySelectorAll(".exhibit-card"));
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const pageInfo = document.getElementById("page-info");
    const pageSizeSelect = document.getElementById("pageSize");

    let currentPage = 1;
    let pageSize = parseInt(pageSizeSelect.value);

    function renderPage() {
        const totalPages = Math.ceil(cards.length / pageSize);
        cards.forEach((card, i) => {
            const show = i >= (currentPage-1)*pageSize && i < currentPage*pageSize;
            card.style.display = show ? "block" : "none";
        });
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage === totalPages;
    }

    prevBtn.addEventListener("click", () => { if(currentPage>1){ currentPage--; renderPage(); } });
    nextBtn.addEventListener("click", () => {
        const totalPages = Math.ceil(cards.length / pageSize);
        if(currentPage<totalPages){ currentPage++; renderPage(); }
    });
    pageSizeSelect.addEventListener("change", e => { pageSize = parseInt(e.target.value); currentPage=1; renderPage(); });

    cards.forEach(card => {
        card.addEventListener("mousemove", e => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateX = ((y - centerY) / centerY) * 8;  
            const rotateY = ((x - centerX) / centerX) * 8;  

            card.style.transform = `translateY(-6px) scale(1.03) rotateX(${ -rotateX }deg) rotateY(${ rotateY }deg)`;
        });

        card.addEventListener("mouseleave", () => {
            card.style.transform = "translateY(0) scale(1) rotateX(0) rotateY(0)";
        });
    });

    renderPage();
});
</script>

<style>
.exhibits-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    perspective: 800px; 
}

.exhibit-card {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    width: 250px;
    height: 350px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.15s ease-out, box-shadow 0.2s ease-out;
    cursor: pointer;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transform-style: preserve-3d; 
    will-change: transform;       
}

.exhibit-card:hover {
    box-shadow: 0 12px 22px rgba(0,0,0,0.25);
}

.exhibit-image img {
    max-width: 100%;
    max-height: 150px;
    object-fit: cover;
    border-radius: 6px;
    display: block;
}
</style>
{% endblock %}
